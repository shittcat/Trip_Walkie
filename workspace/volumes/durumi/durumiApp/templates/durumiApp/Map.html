{% load static %}
<html>
  <head>
    <meta charset="utf-8" />

    <!--모바일 환경 뷰포트 대응-->
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>함께 걸어가는 여행의 동반자! 여행거르미</title>

    <link
      rel="stylesheet"
      type="text/css"
      href=" {% static 'css/SearchList.css' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href=" {% static 'css/uiButtons.css' %}"
    />

    <link rel="manifest" href=" {% static 'manifest.json' %}" />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{% static 'image/apple-touch-icon.png' %}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{% static 'image/favicon-32x32.png' %}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{% static 'image/favicon-16x16.png' %}"
    />
    <link
      rel="mask-icon"
      href="{% static 'image/safari-pinned-tab.svg' %}"
      color="#5bbad5"
    />

    <style>
      body {
        -ms-overflow-style: none;
      }
      ::-webkit-scrollbar {
        display: none;
      } /*스크롤바 감추기 + 고정 */

      #searchDiv {
        position: relative;
        top: 2vh;
        left: 15vw;
        transition: top 1s;
        z-index: 2;
      }

      #searchBox {
        width: 70vw;
        height: 4vh;
        padding: 0.9em 0.9em;
        border: none;
        outline-style: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        font-family: inherit;
        font-size: 1.5em;

        -moz-border-radius-topleft: 10px;
        -moz-border-radius-topright: 10px;
        -moz-border-radius-bottomleft: 10px;
        -moz-border-radius-bottomright: 10px;

        -webkit-border-top-left-radius: 10px;
        -webkit-border-top-right-radius: 10px;
        -webkit-border-bottom-left-radius: 10px;
        -webkit-border-bottom-right-radius: 10px;
      }

      #CatDiv {
        z-index: 2;
      }

      #larCatDiv {
        top: 8vh;
        left: 5vw;
        position: absolute;
        background: red;
        width: 5vw;
        height: 5vh;
        z-index: 3;
      }

      .larCat {
        /*position 속성 선언되어있지 않으면 무조건 아래로 내려감.*/
        float: left;
        margin: 2vh 2vw;
        padding: 1vh 1vw;
        background: white;
        transition: top 0.5s, visibility 0.5s, opacity 0.5s;
        z-index: 2;
      }

      .larCat.main {
        position: relative;
        margin: 2vh 2vw;
        padding: 1vh 1vw;
        background: blue;
        z-index: 3;
      }

      .larCat.other {
        display: none;
      }

      .midCatDiv {
        top: 10vw;
        left: 15vw;
        position: absolute;
        background: green;
        width: 80vw;
        height: 5vh;
        z-index: 4;
      }

      .midCatDiv.main {
        display: block;
      }

      .midCatDiv.other {
        display: none;
      }

      .midCat {
        position: relative;
        float: left;
        margin: 2vh 2vw;
        padding: 1vh 1vw;
        background: white;
        transition: top 0.5s, visibility 0.5s, opacity 0.5s;
        z-index: 2;
      }
    </style>
  </head>
  <body scroll="overflow-x: hidden">
    <div id="popupDiv">
      <!-- 팝업창 -->
      <button id="popCloseBtn">close</button>
    </div>
    <div id="popup_mask"></div>
    <!-- 팝업 배경 DIV. 마스크를 만들어서 씌우는 식으로 뒷 화면을 가리게함 . -->

    <!-- Map이 들어갈 위치를 정해주는 태그-->
    <div
      id="map"
      style="width: 100vw; height: 100vh; z-index: 1; position: absolute"
    >
      <!-- searchBox의 위치를 정해주는 태그-->
      <div id="searchDiv">
        <!--검색을 위한 FORM 태그-->
        <form id="searchForm">
          <!-- 보안을 위해 적어줌-->
          {% csrf_token %}
          <!-- 한개의 문자열로 검색하는 기능-->
          <input
            type="text"
            name="searchBox"
            placeholder="여행지 검색"
            id="searchBox"
          />
          <input type="button" id="search" value="확인" />
        </form>
      </div>
    </div>

    <!-- div 태그 선언 영역 -->

    <div id="openNote" onclick="openTripNote()">opennote</div>
    <div id="noteDiv"></div>

    <div id="openMenu" onclick="openMenu()">openmenu</div>
    <div id="menuDiv"></div>

    <div id="modeChange" onclick="modeChange()">modechange</div>

    <div id="menuDiv"></div>

    <div id="catDiv">
      <div id="larCatDiv">
        <div id="lar0" class="larCat main">larCat0</div>
        <div id="lar1" class="larCat other">larCat1</div>
        <div id="lar2" class="larCat other">larCat2</div>
        <div id="lar3" class="larCat other">larCat3</div>
      </div>

      <div id="larCat0" class="midCatDiv main">
        <div class="midCat">0</div>
        <div class="midCat">0</div>
        <div class="midCat">0</div>
      </div>

      <div id="larCat1" class="midCatDiv other">
        <div class="midCat">1</div>
        <div class="midCat">1</div>
        <div class="midCat">1</div>
      </div>

      <div id="larCat2" class="midCatDiv other">
        <div class="midCat">2</div>
        <div class="midCat">2</div>
        <div class="midCat">2</div>
      </div>

      <div id="larCat3" class="midCatDiv other">
        <div class="midCat">3</div>
        <div class="midCat">3</div>
        <div class="midCat">3</div>
      </div>
    </div>

    <!-- 카카오맵 API를 이용한 지도 띄우기 -->
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=83bbe8eebf0695e3a6a3ef988fe26092"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="{% static 'scripts/searchList.js' %}"></script>
    <script src="{% static 'scripts/uiButtons.js' %}"></script>

    <script>
      //페이지 로드시 초기화할 변수들 모음
      var markers = [];
      var overlays = [];
      $(document).ready(function () {
        SaveDiv = $("#popupDiv").html();
        checkNote = -1; //tripnote 올라왔는지 내려왔는지 체크
        checkMenu = -1; //menu
        viewMode = 1; //place

        $("#element").on("scroll touchmove mousewheel", function (event) {
          /*스크롤바 감추기 + 고정 */ event.preventDefault();
          event.stopPropagation();
          return false;
        });
      });
    </script>

    <script>
      $(".larCat.other").on("click", function (event) {
        var obj = $(event.target);
        var tmp = $(".larCat.main").html();

        $(".larCat.main").html(obj.html());
        obj.html(tmp);

        $(".larCat.other").slideUp();
        changeMidCat($(".larCat.main").html(), obj.html());
      });

      function changeMidCat(catNum1, catNum2) {
        console.log(catNum1);
        $("#" + catNum2).css("display", "none");
        $("#" + catNum1).animate({ width: "toggle" }, 700);
      }

      $(".larCat.main").on("click", function (evnet) {
        $(".larCat.other").slideToggle();
      });

      function openTripNote() {
        console.log(checkNote);
        if (checkNote == 1) {
          //노트 올라와 있는 상태
          $("#noteDiv").css("top", "130vh");
          $("#openNote").css("top", "95vh");
          // $(".midCatDiv").css("display","block");
        } else if (checkNote == -1) {
          //노트 내려와 있는 상태
          $("#noteDiv").css("display", "block"); //팝업창 display block
          $("#noteDiv").load("tripnote/");
          $("#noteDiv").css("top", "70vh");
          $("#openNote").css("top", "68vh");
          // $(".midCatDiv").css("display","none");
        }

        //다른 ui 숨기기
        $("#catDiv").slideToggle(10);
        $("#searchDiv").slideToggle();
        $("#modeChange").slideToggle();
        $("#openMenu").slideToggle();
        checkNote = checkNote * -1;
        // alert("note")
      }
    </script>

    <script>
           	var container = document.getElementById('map');
      var options = {
      	center: new kakao.maps.LatLng({{Map.yPos}} , {{Map.xPos}}),
                level: 3
      };


            var map = new kakao.maps.Map(container, options);


        // 엔터키의 기본기능인 submit 을 제거하고 엔터키를 입력시 search 버튼을 누른것과 같은 효과를 줌
        document.addEventListener('keydown', function(event)
        {
            if (event.keyCode === 13)
            {
                event.preventDefault();
                document.getElementById('search').click();
            };
        }, true);

        function panTo(y,x) //카카오맵 API를 이용해 지도의 중심을 이동시켜주는 함수
        {
            var moveLatLng = new kakao.maps.LatLng(y,x)
            map.panTo(moveLatLng)
        }
    </script>

    <!-- Ajax 를 이용한 template와 view 사이의 통신-->
    <script type="text/javascript">
      $("#search").click(function () {
        //form 에 있는 데이터를 한번에 모아줌 .serialize();
        var formData = $("#searchForm").serialize();
        console.log(formData);
        $.ajax({
          cache: false,
          //어떤 View 와 데이터통신을 진행할것인지 url로 표시
          url: "{% url 'durumiApp:Pos' %}", // Pos view로 데이터를 전송 하면, Pos view 에서는 http로 결과값을 반환하므로, 해당 반환값을 받아서 data로 사용함.
          //POST방식을 사용할것임
          type: "POST",
          data: formData,
          success: function (data) {
            // 성공이라는 메시지를 띄워줌
            alert("성공");
            var jdata = data["result"];
            keywordSearch(jdata);
          },
          error: function (xhr, status) {
            //데이터 통신이 원활이 이루어지지 않으면 실패라는 에러메시지를 띄워줌
            alert("실패");
            alert(xhr + ":" + status);
          },
        });
      });
    </script>
  </body>
</html>
