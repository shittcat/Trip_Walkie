{% load static %}
<html>
    <head>
        <meta charset = "utf-8" />
        <title> 함께 걸어가는 여행의 동반자! 여행거르미</title>
        
        <link rel="stylesheet" type="text/css" href=" {% static 'css/SearchList.css' %}">
        <link rel="stylesheet" type="text/css" href=" {% static 'css/uiButtons.css' %}">
        
        
        <style>
        
        
        body{ -ms-overflow-style: none; } 
        ::-webkit-scrollbar { display: none; } /*스크롤바 감추기 + 고정 */

        #searchDiv {
            position:relative; 
            top:2vh; 
            left:15vw; 
            transition : top 1s;
            z-index:2;
        }
        
        #searchBox{
            width:70vw;
            height: 60px;
            padding: .9em .9em;
            border : none ;
            outline-style: none; 
            -webkit-appearance: none; 
            -moz-appearance: none; 
            font-family: inherit;
            font-size : 30px;
            
        	-moz-border-radius-topleft : 10px;  
            -moz-border-radius-topright: 10px;  
            -moz-border-radius-bottomleft: 10px;  
            -moz-border-radius-bottomright: 10px;  
            
            -webkit-border-top-left-radius: 10px;  
            -webkit-border-top-right-radius: 10px;  
            -webkit-border-bottom-left-radius: 10px;  
            -webkit-border-bottom-right-radius: 10px;  
        }
        
        </style>
    </head>
<body scroll="overflow-x: hidden">
    <div id="popupDiv"> <!-- 팝업창 -->
        <button id="popCloseBtn">close</button>
    </div>
    <div id ="popup_mask" ></div> <!-- 팝업 배경 DIV. 마스크를 만들어서 씌우는 식으로 뒷 화면을 가리게함 . -->

    <!-- Map이 들어갈 위치를 정해주는 태그-->
    <div id = "map" style="width:100vw; height:100vh; z-index:1; position:absolute">
        <!-- searchBox의 위치를 정해주는 태그-->
        <div id="searchDiv" >
            <!--검색을 위한 FORM 태그-->
            <form id="searchForm">
                <!-- 보안을 위해 적어줌-->
                {% csrf_token %}
                <!-- 한개의 문자열로 검색하는 기능-->
                <input type=text name="searchBox" placeholder="여행지 검색" id="searchBox" >
                <input type=button id="search" value="확인">
                
            </form>
        </div>
    </div>
    
    <div id ="openNote" onclick='openTripNote()'>opennote</div> 
    <div id ="noteDiv"></div>
    
    <div id ="openMenu" onclick='openMenu()'>openmenu</div> 
    <div id ="menuDiv"></div>
    
    <div id ="modeChange" onclick='modeChange()'>modechange</div> 
    
    <div id ="menuDiv"></div>
    
    <!-- 카카오맵 API를 이용한 지도 띄우기 -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=9a008f8471540e4e1fe8c0f01ed08a5a"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="{% static 'scripts/searchList.js' %}"></script>
    <script src="{% static 'scripts/uiButtons.js' %}"></script>
    
    <script> //페이지 로드시 초기화할 변수들 모음 
    var markers = [];
    var overlays = [];
    $(document).ready(function()  {
        SaveDiv = $("#popupDiv").html();
        checkNote = -1 ; //tripnote 올라왔는지 내려왔는지 체크 
        checkMenu = -1 ; //menu
        viewMode = 1 ; //place
        
        $('#element').on('scroll touchmove mousewheel', function(event) { /*스크롤바 감추기 + 고정 */
            event.preventDefault();
            event.stopPropagation();
            return false;
        });
        
    }); 
    </script>
    
    
    <script>
    function openTripNote(){
        console.log(checkNote);
        if (checkNote == 1){ //노트 올라와 있는 상태 
            $("#noteDiv").css("top","130vh");
            $("#openNote").css("top","95vh");
            
            $("#searchDiv").css("top","2vh");
            $("#modeChange").css("top","3vh");
            $("#openMenu").css("top","3vh");
            
        }
        else if(checkNote == -1){//노트 내려와 있는 상태 
            $("#noteDiv").css("display","block"); //팝업창 display block
            $("#noteDiv").load("tripnote/");
            $("#noteDiv").css("top","70vh");
            $("#openNote").css("top","68vh");
            
            //다른 ui 숨기기
            $("#searchDiv").css("top","-30vh");
            $("#modeChange").css("top","-30vh");
            $("#openMenu").css("top","-30vh");
        }
        
        checkNote = checkNote * -1; 
       // alert("note")
    }
    
    </script>


    <script>
       	var container = document.getElementById('map');
		var options = {
			center: new kakao.maps.LatLng({{Map.yPos}} , {{Map.xPos}}),
            level: 3
		};
		
        
        var map = new kakao.maps.Map(container, options);


    // 엔터키의 기본기능인 submit 을 제거하고 엔터키를 입력시 search 버튼을 누른것과 같은 효과를 줌
    document.addEventListener('keydown', function(event) 
    {
        if (event.keyCode === 13) 
        {
            event.preventDefault();
            document.getElementById('search').click();
        };
    }, true);
    
    function panTo(y,x) //카카오맵 API를 이용해 지도의 중심을 이동시켜주는 함수
    {
        var moveLatLng = new kakao.maps.LatLng(y,x)
        map.panTo(moveLatLng)
    }
    </script>

    <!-- Ajax 를 이용한 template와 view 사이의 통신-->
    <script type="text/javascript">
    $('#search').click(function()
    {
        //form 에 있는 데이터를 한번에 모아줌 .serialize();
        var formData = $("#searchForm").serialize();
        console.log(formData);
        $.ajax
        ({
            cache: false,
            //어떤 View 와 데이터통신을 진행할것인지 url로 표시
            url : "{% url 'durumiApp:Pos' %}", // Pos view로 데이터를 전송 하면, Pos view 에서는 http로 결과값을 반환하므로, 해당 반환값을 받아서 data로 사용함. 
            //POST방식을 사용할것임
            type: 'POST',
            data: formData,
            success : function(data)
            {
                // 성공이라는 메시지를 띄워줌
                alert("성공");
                var jdata = data['result'];
                keywordSearch(jdata);
            },
            error : function(xhr, status,)
            {
                //데이터 통신이 원활이 이루어지지 않으면 실패라는 에러메시지를 띄워줌
                alert("실패");
                alert(xhr + ":" + status);
            },
        });
    })
</script>